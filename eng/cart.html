<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cart – AlbaSpace</title>

  <link rel="stylesheet" href="/assets/css/site.css">
  <link rel="stylesheet" href="/assets/css/shop.css">

  <style> :root { --header-bg: #020617; --accent: #00c2ff; --page-bg: #050b27; --text-main: #ffffff; --text-muted: #9ca3af; } /* Background image integration */ /* Payment icons styles */ .chart-payment-bar { display:flex; justify-content:center; margin-top: 20px; margin-bottom:18px; } .chart-payment-bar .payment-icons { position:relative; display: flex; gap:24px; justify-content:center; align-items:center; padding:6px 12px; border-radius:10px; z-index:3; /* Slight background for readability */ } .chart-payment-bar .payment-icons img { width:52px; height:auto; opacity:0.95; } .chart-payment-bar .payment-icons-link { display:block !important; position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); width:calc(100% + 36px); height:72px; -webkit-backdrop-filter: blur(6px); backdrop-filter: blur(6px); border-radius:10px; z-index:2; cursor:pointer; } /* WhatsApp button extra style */ .whatsapp-btn { display: inline-block; margin-top: 10px; width: 100%; text-align: center; background-color: #25D366; color: white; padding: 10px; border-radius: 5px; text-decoration: none; font-weight: bold; } .whatsapp-btn:hover { background-color: #128C7E; } </style>

  <script src="/assets/js/include.js" defer></script>
  <script src="/assets/js/menu-toggle.js" defer></script>
  <script src="/assets/js/cart.js" defer></script>
</head>

<body>

  <div data-include="/header-en.html"></div>

  <main class="cart-page">
    <h1>Cart</h1>

    <section id="cartItems"></section>

    <section class="cart-summary" id="cartSummary">
      <div class="cart-total-row">
        <span>Total:</span>
        <span id="cartTotal">$0.00</span>
      </div>

      <div class="shipping-estimate">
        <h2>Estimated Shipping & Handling</h2>
        <form>
          <label>
            Country
            <select>
              <option value="Turkey">Turkey</option>
              <option value="United States">United States</option>
              <option value="United Kingdom">United Kingdom</option>
              <option value="Ukraine">Ukraine</option>
              <option value="Russia">Russia</option>
            </select>
          </label>

          <label>
            State / Province
            <input type="text" placeholder="State or Province">
          </label>

          <label>
            Zip / Postal Code
            <input type="text" placeholder="Zip Code">
          </label>

          <button type="button" class="btn-secondary">Calculate</button>
        </form>
      </div>

      <button class="btn-primary checkout-btn" type="button">CHECKOUT</button>
      
      <a class="whatsapp-btn" href="https://wa.me/905387781018" target="_blank" rel="noopener">PAY VIA WHATSAPP</a>

      <div class="chart-payment-bar">
        <div class="payment-icons" aria-hidden="true">
          <span class="payment-icons-link" role="link" tabindex="0" onclick="location.href='/chart.html';" onkeydown="if(event.key==='Enter'){location.href='/chart.html';}"></span>
          <img src="/assets/icons/iyzico_tr.png" alt="iyzico">
          <img src="/assets/icons/mastercard.png" alt="mastercard">
          <img src="/assets/icons/visa.png" alt="visa">
        </div>
      </div>

    </section>

    <p id="emptyCartMessage" class="cart-empty" hidden>Your cart is empty.</p>
  </main>

  <div data-include="/footer-en.html"></div>

  <script>
    /**
     * Function to render cart content in English with currency conversion.
     * Exchange rate: 1 USD = 43 TL
     */
    function renderCartEN() {
      const container = document.getElementById('cartItems');
      const summary = document.getElementById('cartSummary');
      const emptyMsg = document.getElementById('emptyCartMessage');
      const totalEl = document.getElementById('cartTotal');
      
      // Load cart data (Prices are assumed to be in TL in the storage)
      const cart = cartManager.load();
      const EXCHANGE_RATE = 43;

      if (!cart.length) {
        container.innerHTML = '';
        summary.style.display = 'none';
        emptyMsg.hidden = false;
        return;
      }

      emptyMsg.hidden = true;
      summary.style.display = '';

      let totalUSD = 0;

      container.innerHTML = cart.map((item, index) => {
        // Convert unit price to USD
        const priceUSD = item.price / EXCHANGE_RATE;
        const itemTotalUSD = priceUSD * item.qty;
        
        totalUSD += itemTotalUSD;
        
        return `
          <article class="cart-item" data-index="${index}">
            <img src="${item.image}" alt="${item.name}">
            <div class="cart-item-main">
              <h2>${item.name}</h2>
              <p>${item.color ? item.color : ''}${item.size ? ' / ' + item.size : ''}</p>
              <div class="cart-item-price">$${priceUSD.toFixed(2)}</div>
            </div>
            <div class="cart-item-actions">
              <div class="qty-control" data-qty>
                <button type="button" class="qty-btn" data-qty-minus>&minus;</button>
                <input type="number" min="1" value="${item.qty}" class="qty-input" data-qty-input>
                <button type="button" class="qty-btn" data-qty-plus>&plus;</button>
              </div>
              <button type="button" class="cart-remove" data-remove>Remove</button>
              <div class="cart-item-total">$${itemTotalUSD.toFixed(2)}</div>
            </div>
          </article>
        `;
      }).join('');

      // Display total in USD
      totalEl.textContent = '$' + totalUSD.toFixed(2);

      // Bind event handlers
      container.querySelectorAll('.cart-item').forEach(row => {
        const index = Number(row.dataset.index);
        const input = row.querySelector('[data-qty-input]');

        row.querySelector('[data-qty-minus]').addEventListener('click', () => {
          const value = Math.max(1, Number(input.value || '1') - 1);
          input.value = value;
          cartManager.updateQty(index, value);
          renderCartEN();
        });

        row.querySelector('[data-qty-plus]').addEventListener('click', () => {
          const value = Number(input.value || '1') + 1;
          input.value = value;
          cartManager.updateQty(index, value);
          renderCartEN();
        });

        row.querySelector('[data-remove]').addEventListener('click', () => {
          cartManager.remove(index);
          renderCartEN();
        });
      });
    }

    document.addEventListener('DOMContentLoaded', renderCartEN);
  </script>

  <script>
      // Sayfa Yüklendiğinde Popup Kontrolü
      document.addEventListener("DOMContentLoaded", function() {
          // localStorage kontrolü: Kullanıcı daha önce "kabul ettim" dedi mi?
          if (!localStorage.getItem("albaCookieSeen")) {
              document.getElementById("cookie-overlay").style.display = "flex";
          }
      });

      const acceptBtn = document.getElementById("btnAccept");
      const settingsBtn = document.getElementById("btnSettings");

      // Üst buton: Animasyon ve Kapatma
      if(acceptBtn) {
          acceptBtn.addEventListener("click", function() {
              // Butona basıldığını hissettirmek için ufak bir bekleme (opsiyonel)
              setTimeout(() => {
                  document.getElementById("cookie-overlay").style.display = "none";
                  // Kullanıcının gördüğünü tarayıcıya kaydet
                  localStorage.setItem("albaCookieSeen", "true");
              }, 200);
          });
      }

      // Alt buton: Çerez politikası sayfasına yönlendirir
      if(settingsBtn) {
          settingsBtn.addEventListener("click", function() {
               window.location.href = "cerez-politikasi.html";
          });
      }
  </script>
</body>
</html>